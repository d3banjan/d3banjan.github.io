---
import { getPublishedBnPosts, getPublishedPosts } from '../consts';

interface Props {
	currentId: string;
	seriesName: string;
	seriesOrder: number;
	defaultLang?: 'en' | 'bn';
}

const { currentId, seriesName, seriesOrder, defaultLang = 'en' } = Astro.props;
const isBn = defaultLang === 'bn';

const allPosts = isBn ? await getPublishedBnPosts() : await getPublishedPosts();
const seriesPosts = allPosts
	.filter((p) => p.data.series === seriesName)
	.sort((a, b) => (a.data.seriesOrder ?? 0) - (b.data.seriesOrder ?? 0));

const currentIndex = seriesPosts.findIndex((p) => p.id === currentId);
const next = currentIndex >= 0 && currentIndex < seriesPosts.length - 1
	? seriesPosts[currentIndex + 1]
	: null;
const prev = currentIndex > 0 ? seriesPosts[currentIndex - 1] : null;

const urlPrefix = isBn ? '/bn/' : '/blog/';
---

{next && (
	<p class="series-next">
		<em>
			{isBn
				? <span>পরের পর্ব: <a href={`${urlPrefix}${next.id}/`}>{next.data.title}</a></span>
				: <span>Next in this series: <a href={`${urlPrefix}${next.id}/`}>{next.data.title}</a></span>
			}
		</em>
	</p>
)}
{!next && prev && (
	<p class="series-next">
		<em>{isBn ? 'এটি এই সিরিজের শেষ পর্ব।' : 'This is the final post in this series.'}</em>
	</p>
)}

<style>
	.series-next {
		margin-top: 2em;
		color: rgb(var(--gray));
		font-size: 0.95em;
	}
	.series-next a {
		color: var(--accent);
		text-decoration: none;
	}
	.series-next a:hover {
		text-decoration: underline;
	}
</style>
